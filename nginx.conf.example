# Example Nginx configuration for YTDL2 PWA
# Copy this file to your nginx sites-available directory and modify as needed

server {
    listen 80;
    server_name yourdomain.com;  # Change this to your domain
    
    # Redirect HTTP to HTTPS (recommended for PWA)
    # Uncomment after setting up SSL
    # return 301 https://$server_name$request_uri;
}

# HTTPS configuration (recommended for PWA)
# Uncomment after obtaining SSL certificate
# server {
#     listen 443 ssl http2;
#     server_name yourdomain.com;
#     
#     # SSL certificate files (update paths)
#     ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
#     
#     # Modern SSL configuration
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#     ssl_prefer_server_ciphers on;
    
    # Path to your built app (change this!)
    root /path/to/ytdl2/dist;
    index index.html;
    
    # Enable gzip compression for better performance
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/rss+xml
        font/truetype
        font/opentype
        application/vnd.ms-fontobject
        image/svg+xml;
    
    # Client-side routing support
    # All requests should be redirected to index.html for React Router to handle
    location / {
        try_files $uri $uri/ /index.html;
        
        # Security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
    }
    
    # Cache static assets with long expiration
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # Service worker - DO NOT cache, always serve fresh
    location = /sw.js {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
        proxy_cache_bypass $http_pragma;
        proxy_cache_revalidate on;
    }
    
    # Web app manifest - minimal caching
    location = /manifest.webmanifest {
        add_header Cache-Control "max-age=3600, must-revalidate";
        add_header Content-Type "application/manifest+json";
    }
    
    # Workbox related files
    location ~* ^/workbox-.+\.js$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }
    
    # Deny access to hidden files
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
# }

# Notes:
# 1. Update 'server_name' with your actual domain
# 2. Update 'root' path to point to your built app's dist directory
# 3. For PWA to work properly, HTTPS is strongly recommended
# 4. Use certbot to obtain free SSL certificates: sudo certbot --nginx -d yourdomain.com
# 5. After making changes, test config: sudo nginx -t
# 6. Reload nginx: sudo systemctl reload nginx

